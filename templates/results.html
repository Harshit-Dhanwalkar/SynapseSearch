<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Results for "{{ query }}" - SynapseSearch</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <style>
      /* --- Theme-specific styles --- */
      html[data-theme="dark"] body {
        background-color: #1a202c;
        color: #e2e8f0;
      }

      html[data-theme="light"] body {
        background-color: #ffffff;
        color: #2d3748;
      }

      html[data-theme="cyberpunk"] body {
        background-color: #0d0d0d;
        color: #4bff21;
        font-family: "Space Mono", monospace;
      }

      html[data-theme="dark"] .bg-white {
        background-color: #2d3748;
      }

      html[data-theme="dark"] .text-gray-600 {
        color: #cbd5e0;
      }

      html[data-theme="dark"] .bg-gray-100 {
        background-color: #4a5568;
      }

      html[data-theme="dark"] .hover\:bg-gray-200:hover {
        background-color: #718096;
      }

      html[data-theme="cyberpunk"] .bg-white {
        background-color: #1a202c;
      }

      html[data-theme="cyberpunk"] .text-gray-600 {
        color: #00f0ff;
      }
      html[data-theme="cyberpunk"] .hover\:bg-gray-200:hover {
        background-color: #1a202c;
      }

      html[data-theme="cyberpunk"] input {
        border-color: #772289;
      }
      .tab-active {
        border-bottom: 2px solid #3b82f6;
        color: #3b82f6;
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col items-center">
    <header
      class="w-full flex items-center justify-between p-4 bg-gray-800 text-white shadow-lg"
    >
      <a href="/" class="flex-shrink-0 text-2xl font-bold">SynapseSearch</a>
      <div class="flex-grow max-w-xl mx-4">
        <form action="/search" method="get" class="relative">
          <input
            type="text"
            name="query"
            value="{{ query }}"
            class="w-full px-4 py-2 border rounded-full text-black"
            placeholder="Search again..."
          />
          <input
            type="hidden"
            name="mode"
            value="{{ request.args.get('mode', 'keyword') }}"
          />
          <button
            type="submit"
            class="absolute right-0 top-0 mt-2 mr-4 text-gray-500"
          >
            <i class="fas fa-search"></i>
          </button>
        </form>
      </div>
      <button id="theme-toggle" class="focus:outline-none">
        <i class="fas fa-moon text-xl" data-theme-icon="dark"></i>
        <i class="fas fa-sun text-xl hidden" data-theme-icon="light"></i>
        <i class="fas fa-robot text-xl hidden" data-theme-icon="cyberpunk"></i>
      </button>
    </header>

    <main class="w-full max-w-4xl p-6 flex-grow">
      <div class="flex border-b border-gray-700 mb-6">
        <button
          onclick="changeContentType('all')"
          class="py-2 px-4 {% if content_type == 'all' %}tab-active{% else %}text-gray-400{% endif %}"
        >
          All
        </button>
        <button
          onclick="changeContentType('images')"
          class="py-2 px-4 {% if content_type == 'images' %}tab-active{% else %}text-gray-400{% endif %}"
        >
          Images
        </button>
      </div>

      <div class="text-xl font-semibold mb-4">{{ message }}</div>

      {% if content_type == 'all' %}
      <div class="space-y-6">
        {% for result in results %}
        <div
          class="bg-gray-800 p-4 rounded-lg shadow-md hover:bg-gray-700 transition-colors"
        >
          <a
            href="{{ result.url }}"
            class="block text-xl font-semibold text-blue-400 hover:underline"
            >{{ result.title }}</a
          >
          <div class="text-sm text-green-400">{{ result.url|url_domain }}</div>

          <p class="text-gray-300 mt-2">
            {{ result.snippet }}...
            <span class="text-gray-500">Score: {{ result.score }}</span>
          </p>

          {% if result.images %}
          <div class="flex mt-4 gap-2">
            {% for image in result.images[:3] %}
            <img
              src="{{ image.src }}"
              alt="{{ image.alt }}"
              class="h-16 w-16 object-cover rounded"
            />
            {% endfor %}
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
      {% elif content_type == 'images' %}
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
        {% for result in results %} {% for image in result.images %}
        <div class="relative group">
          <a href="{{ result.url }}">
            <img
              src="{{ image.src }}"
              alt="{{ image.alt }}"
              class="w-full h-48 object-cover rounded-lg group-hover:opacity-75"
            />
            <div
              class="absolute bottom-0 left-0 right-0 p-2 bg-black bg-opacity-50 text-white text-xs rounded-b-lg hidden group-hover:block"
            >
              {{ image.alt }}
            </div>
          </a>
        </div>
        {% endfor %} {% endfor %}
      </div>
      {% endif %}
    </main>

    <script>
      // Theme switching logic
      const html = document.documentElement;
      const themeToggle = document.getElementById("theme-toggle");
      const themeIcons = {
        dark: document.querySelector('[data-theme-icon="dark"]'),
        light: document.querySelector('[data-theme-icon="light"]'),
        cyberpunk: document.querySelector('[data-theme-icon="cyberpunk"]'),
      };
      const themes = ["dark", "light", "cyberpunk"];

      function getSavedTheme() {
        return localStorage.getItem("theme") || "dark";
      }

      function setTheme(theme) {
        html.setAttribute("data-theme", theme);
        localStorage.setItem("theme", theme);
        Object.values(themeIcons).forEach((icon) =>
          icon.classList.add("hidden"),
        );
        themeIcons[theme].classList.remove("hidden");
      }

      function cycleTheme() {
        const currentTheme = getSavedTheme();
        const currentIndex = themes.indexOf(currentTheme);
        const nextIndex = (currentIndex + 1) % themes.length;
        const nextTheme = themes[nextIndex];
        setTheme(nextTheme);
      }

      setTheme(getSavedTheme());
      themeToggle.addEventListener("click", cycleTheme);

      function changeContentType(type) {
        const url = new URL(window.location.href);
        url.searchParams.set("type", type);
        window.location.href = url.toString();
      }
    </script>
  </body>
</html>
